# Udemy AWS CDK Masterclass

## General

-   When working with CDK in TypeScript, the CDK CLI can be installed directly
-   CDK generates L1 constructs, but allows for higher abstraction by using L2 and L3 constructs
-   Physical IDs of CDK resources equal ARNs

## Project Structure

-   _bin_ folder contains app, _lib_ folder contains constructs and stacks
-   _cdk.out_ folder contains CloudFormation template generated by CDK

## Basic Functionality

-   [Outputs][1] can be used to get information on resources. They also enable sharing information between stacks using the _exportName_ property
-   Outputs can be saved to disk via `cdk deploy --outputs-file file.json`
-   [Parameters][2] [...] can be passed via `cdk deploy --parameters <name> <value>` # TODO: Double Check with documentation
-   CloudFormation functions (FN) can be used from CDK, i.e. to use information provided by _Outputs_. A **better** way is to expose required information via properties and pass them around directly in CDK
-   [Aspects][4] can apply operations to constructs after they have been created. Thus, they can be used to validate parameters, i.e. existence removal and logging policies

## Advanced Functionality

-   [StackSets][3] are container of stacks and enable create/update/delete of stack instances across multiple accounts and regions

## Testing

-   Use [jest][8] to write tests
-   Use the CloudFormation template to easily define the properties you want to test against
-   Use [matchers][9] to test properties of resources with (a partly) unknown id. An alternative to matchers are [captures][9]
-   Consider snapshot testing for parts of the code, i.e. individual constructs
-   Use [aws-sdk-client-mock][10] to mock calls to AWS SKD in TS
-   Passsing AWS clients as arguments to Lambda functions allows for easier mocking in tests

## Misc

-   Use the VSCode debugger to test Lambda functions
-   Check out the marshall/unmarshall [utilties][5] for DynamoDB
-   Consider catching JSON parsing error with custom function?
-   Use randomUUID from crypto instead using uuid library
-   You can just import types from NPM packages via _as type_
-   Check out [jwt.io][6] when working with JWT
-   Cognito uses JWT for authorization
-   Cognito supports authorization of individual users via groups
-   Cognito users can get temporary AWS credentials with access to IAM roles via Cognito identity pools
-   Use npm scripts (`npm run <script>`) to simplify execution of CLI commands
-   Simple websites can be hosted on S3
-   Use CloudWatch alarms using re-defined CloudWatch metrics, i.e. for 400 errors when using API Gateway
-   Use the AWS CLI (via `aws cloudwatch describe-alarms`) to get information about existing alarms in order to infer values for CDK
-   Use SNS/Lambda/Webhooks and [adaptive cards][7] to sent alerts (for alarms) to Teams
-   Checko out X-Ray tracking to investigate Lambda performance issues
-   In order to use X-Ray tracing with Lambdas, it needs to be activated

[1]: https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk/CfnOutput.html
[2]: https://docs.aws.amazon.com/cdk/v2/guide/parameters.html
[3]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-concepts.html
[4]: https://docs.aws.amazon.com/cdk/v2/guide/aspects.html
[5]: https://www.npmjs.com/package/@aws-sdk/util-dynamodb
[6]: https://jwt.io
[7]: https://adaptivecards.io/
[8]: https://jestjs.io/docs/getting-started
[9]: https://docs.aws.amazon.com/cdk/v2/guide/testing.html
[10]: https://www.npmjs.com/package/aws-sdk-client-mock
